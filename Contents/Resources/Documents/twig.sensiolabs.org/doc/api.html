<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index, follow, all" />
    <meta name="Author" content="Sensio Labs" />
    <meta name="Language" content="en" />
    <meta name="Copyright" content="Sensio" />
    <meta name="Publisher" content="Sensio" />
    <meta name="Description" content="Twig - The flexible, fast, and secure template engine for PHP" />
    <meta name="Keywords" content="twig, templating, template, engine, template engine, template language, php" />

    <title>Twig for Developers - Documentation - Twig - The flexible, fast, and secure PHP template engine</title>

    <link href="../css/reset-min.css" rel="stylesheet" type="text/css" />
    <link href="../css/base.css" rel="stylesheet" type="text/css" />
    <link href="../css/colors.css" rel="stylesheet" type="text/css" />
    <link href="../css/code.css" rel="stylesheet" type="text/css" />
    <link href="../css/pygments.css" rel="stylesheet" type="text/css" />

    
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/twig-project" />

    <link href="http://connect.sensiolabs.com/css/sln.css" rel="stylesheet" type="text/css" media="all" />

    <script type="text/javascript" src="../js/jquery-1.7.2.min.js"></script>

    <script type="text/javascript">
        (function(w, d, s) {
            function go() {
                var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
                    if (d.getElementById(id)) {return;}
                    js = d.createElement(s); js.src = url; js.id = id;
                    fjs.parentNode.insertBefore(js, fjs);
                };
                load('https://connect.sensiolabs.com/sln.js?customize_url=/js/sln_customize.js', 'sln_bar');
            }
            if (w.addEventListener) { w.addEventListener("load", go, false); }
            else if (w.attachEvent) { w.attachEvent("onload",go); }
        } (window, document, 'script'));
    </script>

    <!--[if IE 6]>
      <script type="text/javascript" src="/js/DD_belatedPNG_0.0.7a-min.js"></script>
      <script type="text/javascript">
        DD_belatedPNG.fix('.png_fix');
      </script>
    <![endif]-->

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10931939-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
  </head>
  <body>
    <div id="sln"></div>
    <div class="hd">
      <div class="illustration png_fix">
        <div class="content">
          <div class="sensio_product">
            <img class="png_fix" src="../images/sensio-labs-product.png" alt="a Sensio Labs Product" />
          </div>
          <div class="clearfix">
            <div class="logo_header"><a href="../index.html">TWIG</a></div>
            <h1 class="title_header">
              The flexible, fast, and secure<br />template engine for PHP
            </h1>
          </div>

          <div class="menu">
            <ul>
              <li><a href="../index.html">ABOUT</a></li>
              <li><a class="active" href="../documentation">DOCUMENTATION</a></li>
              <li><a href="http://blog.twig.sensiolabs.org/">BLOG</a></li>
              <li><a href="../development">DEVELOPMENT</a></li>
              <li><a href="../contributors">CONTRIBUTORS</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="bd">
      <div class="content">
                        <div class="infobar clearfix">
                    <div id="doc-toc" class="infobar-box">
            <h3>Table of Contents</h3>
            <ul>
<li><a class="reference internal" href="api.html#">Twig for Developers</a><ul>
<li><a class="reference internal" href="api.html#basics">Basics</a></li>
<li><a class="reference internal" href="api.html#environment-options">Environment Options</a></li>
<li><a class="reference internal" href="api.html#loaders">Loaders</a><ul>
<li><a class="reference internal" href="api.html#compilation-cache">Compilation Cache</a></li>
<li><a class="reference internal" href="api.html#built-in-loaders">Built-in Loaders</a><ul>
<li><a class="reference internal" href="api.html#twig-loader-filesystem"><tt class="docutils literal"><code>Twig_Loader_Filesystem</code></tt></a></li>
<li><a class="reference internal" href="api.html#twig-loader-string"><tt class="docutils literal"><code>Twig_Loader_String</code></tt></a></li>
<li><a class="reference internal" href="api.html#twig-loader-array"><tt class="docutils literal"><code>Twig_Loader_Array</code></tt></a></li>
<li><a class="reference internal" href="api.html#twig-loader-chain"><tt class="docutils literal"><code>Twig_Loader_Chain</code></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="api.html#create-your-own-loader">Create your own Loader</a></li>
</ul>
</li>
<li><a class="reference internal" href="api.html#using-extensions">Using Extensions</a></li>
<li><a class="reference internal" href="api.html#built-in-extensions">Built-in Extensions</a><ul>
<li><a class="reference internal" href="api.html#core-extension">Core Extension</a></li>
<li><a class="reference internal" href="api.html#escaper-extension">Escaper Extension</a></li>
<li><a class="reference internal" href="api.html#sandbox-extension">Sandbox Extension</a></li>
<li><a class="reference internal" href="api.html#optimizer-extension">Optimizer Extension</a></li>
</ul>
</li>
<li><a class="reference internal" href="api.html#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>

            </div>
        
        <div class="infobar-box">
            <h3>Questions &amp; Feedback</h3>
            <div class="feedback">
                <p>
                  <strong>Found a typo or an error?</strong><br />
                  Want to improve this document? <a href="https://github.com/fabpot/Twig/edit/master/doc/api.rst">Edit</a> it.
                </p>
                <p>
                  <strong>Need support or have a technical question?</strong><br />
                  Post to the <a href="http://groups.google.com/group/twig-users">user mailing-list</a>.
                 </p>
            </div>

            <h3>License</h3>
            <div id="license">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" src="http://symfony.com/images/license.png" /></a>
                Twig <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/MovingImage" rel="dc:type">documentation</span> is licensed under a
                Creative Commons Attribution-Share Alike 3.0
                Unported <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">License</a>.
            </div>
        </div>
    </div>

    <div class="body-web">
        <div class="section" id="twig-for-developers">
<h1>Twig for Developers<a class="headerlink" href="api.html#twig-for-developers" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes the API to Twig and not the template language. It will
be most useful as reference to those implementing the template interface to
the application and not those who are creating Twig templates.</p>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="api.html#basics" title="Permalink to this headline">¶</a></h2>
<p>Twig uses a central object called the <strong>environment</strong> (of class
<tt class="docutils literal"><code>Twig_Environment</code></tt>). Instances of this class are used to store the
configuration and extensions, and are used to load templates from the file
system or other locations.</p>
<p>Most applications will create one <tt class="docutils literal"><code>Twig_Environment</code></tt> object on application
initialization and use that to load templates. In some cases it's however
useful to have multiple environments side by side, if different configurations
are in use.</p>
<p>The simplest way to configure Twig to load templates for your application
looks roughly like this:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">require_once</span> <span class="s1">&#39;/path/to/lib/Twig/Autoloader.php&#39;</span><span class="p">;</span>
<span class="nx">Twig_Autoloader</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="s1">&#39;/path/to/templates&#39;</span><span class="p">);</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/path/to/compilation_cache&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>This will create a template environment with the default settings and a loader
that looks up the templates in the <tt class="docutils literal"><code>/path/to/templates/</code></tt> folder. Different
loaders are available and you can also write your own if you want to load
templates from a database or other resources.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Notice that the second argument of the environment is an array of options.
The <tt class="docutils literal"><code>cache</code></tt> option is a compilation cache directory, where Twig caches
the compiled templates to avoid the parsing phase for sub-sequent
requests. It is very different from the cache you might want to add for
the evaluated templates. For such a need, you can use any available PHP
cache library.</p>
</div></div>
<p>To load a template from this environment you just have to call the
<tt class="docutils literal"><code>loadTemplate()</code></tt> method which then returns a <tt class="docutils literal"><code>Twig_Template</code></tt> instance:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$template</span> <span class="o">=</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">loadTemplate</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>To render the template with some variables, call the <tt class="docutils literal"><code>render()</code></tt> method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;the&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;here&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><code>display()</code></tt> method is a shortcut to output the template directly.</p>
</div></div>
<p>You can also load and render the template in one fell swoop:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;the&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;here&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="environment-options">
<span id="id1"></span><h2>Environment Options<a class="headerlink" href="api.html#environment-options" title="Permalink to this headline">¶</a></h2>
<p>When creating a new <tt class="docutils literal"><code>Twig_Environment</code></tt> instance, you can pass an array of
options as the constructor second argument:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>The following options are available:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>debug</code></tt>: When set to <tt class="docutils literal"><code>true</code></tt>, the generated templates have a
<tt class="docutils literal"><code>__toString()</code></tt> method that you can use to display the generated nodes
(default to <tt class="docutils literal"><code>false</code></tt>).</li>
<li><tt class="docutils literal"><code>charset</code></tt>: The charset used by the templates (default to <tt class="docutils literal"><code>utf-8</code></tt>).</li>
<li><tt class="docutils literal"><code>base_template_class</code></tt>: The base template class to use for generated
templates (default to <tt class="docutils literal"><code>Twig_Template</code></tt>).</li>
<li><tt class="docutils literal"><code>cache</code></tt>: An absolute path where to store the compiled templates, or
<tt class="docutils literal"><code>false</code></tt> to disable caching (which is the default).</li>
<li><tt class="docutils literal"><code>auto_reload</code></tt>: When developing with Twig, it's useful to recompile the
template whenever the source code changes. If you don't provide a value for
the <tt class="docutils literal"><code>auto_reload</code></tt> option, it will be determined automatically based on the
<tt class="docutils literal"><code>debug</code></tt> value.</li>
<li><tt class="docutils literal"><code>strict_variables</code></tt>: If set to <tt class="docutils literal"><code>false</code></tt>, Twig will silently ignore invalid
variables (variables and or attributes/methods that do not exist) and
replace them with a <tt class="docutils literal"><code>null</code></tt> value. When set to <tt class="docutils literal"><code>true</code></tt>, Twig throws an
exception instead (default to <tt class="docutils literal"><code>false</code></tt>).</li>
<li><tt class="docutils literal"><code>autoescape</code></tt>: If set to <tt class="docutils literal"><code>true</code></tt>, auto-escaping will be enabled by default
for all templates (default to <tt class="docutils literal"><code>true</code></tt>). As of Twig 1.8, you can set the
escaping strategy to use (<tt class="docutils literal"><code>html</code></tt>, <tt class="docutils literal"><code>js</code></tt>, <tt class="docutils literal"><code>false</code></tt> to disable).
As of Twig 1.9, you can set the escaping strategy to use (<tt class="docutils literal"><code>css</code></tt>, <tt class="docutils literal"><code>url</code></tt>,
<tt class="docutils literal"><code>html_attr</code></tt>, or a PHP callback that takes the template &quot;filename&quot; and must
return the escaping strategy to use -- the callback cannot be a function name
to avoid collision with built-in escaping strategies).</li>
<li><tt class="docutils literal"><code>optimizations</code></tt>: A flag that indicates which optimizations to apply
(default to <tt class="docutils literal"><code>-1</code></tt> -- all optimizations are enabled; set it to <tt class="docutils literal"><code>0</code></tt> to
disable).</li>
</ul>
</div>
<div class="section" id="loaders">
<h2>Loaders<a class="headerlink" href="api.html#loaders" title="Permalink to this headline">¶</a></h2>
<p>Loaders are responsible for loading templates from a resource such as the file
system.</p>
<div class="section" id="compilation-cache">
<h3>Compilation Cache<a class="headerlink" href="api.html#compilation-cache" title="Permalink to this headline">¶</a></h3>
<p>All template loaders can cache the compiled templates on the filesystem for
future reuse. It speeds up Twig a lot as templates are only compiled once; and
the performance boost is even larger if you use a PHP accelerator such as APC.
See the <tt class="docutils literal"><code>cache</code></tt> and <tt class="docutils literal"><code>auto_reload</code></tt> options of <tt class="docutils literal"><code>Twig_Environment</code></tt> above
for more information.</p>
</div>
<div class="section" id="built-in-loaders">
<h3>Built-in Loaders<a class="headerlink" href="api.html#built-in-loaders" title="Permalink to this headline">¶</a></h3>
<p>Here is a list of the built-in loaders Twig provides:</p>
<div class="section" id="twig-loader-filesystem">
<h4><tt class="docutils literal"><code>Twig_Loader_Filesystem</code></tt><a class="headerlink" href="api.html#twig-loader-filesystem" title="Permalink to this headline">¶</a></h4>
<p class="versionadded">
<span class="versionmodified">New in version 1.10: </span>The <tt class="docutils literal"><code>prependPath()</code></tt> and support for namespaces were added in Twig 1.10.</p>
<p><tt class="docutils literal"><code>Twig_Loader_Filesystem</code></tt> loads templates from the file system. This loader
can find templates in folders on the file system and is the preferred way to
load them:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="nv">$templateDir</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>It can also look for templates in an array of directories:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$templateDir1</span><span class="p">,</span> <span class="nv">$templateDir2</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>With such a configuration, Twig will first look for templates in
<tt class="docutils literal"><code>$templateDir1</code></tt> and if they do not exist, it will fallback to look for them
in the <tt class="docutils literal"><code>$templateDir2</code></tt>.</p>
<p>You can add or prepend paths via the <tt class="docutils literal"><code>addPath()</code></tt> and <tt class="docutils literal"><code>prependPath()</code></tt>
methods:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addPath</span><span class="p">(</span><span class="nv">$templateDir3</span><span class="p">);</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">prependPath</span><span class="p">(</span><span class="nv">$templateDir4</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>The filesystem loader also supports namespaced templates. This allows to group
your templates under different namespaces which have their own template paths.</p>
<p>When using the <tt class="docutils literal"><code>setPaths()</code></tt>, <tt class="docutils literal"><code>addPath()</code></tt>, and <tt class="docutils literal"><code>prependPath()</code></tt> methods,
specify the namespace as the second argument (when not specified, these
methods act on the &quot;main&quot; namespace):</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addPath</span><span class="p">(</span><span class="nv">$templateDir</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Namespaced templates can be accessed via the special
<tt class="docutils literal"><code>&#64;namespace_name/template_path</code></tt> notation:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;@admin/index.html&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="twig-loader-string">
<h4><tt class="docutils literal"><code>Twig_Loader_String</code></tt><a class="headerlink" href="api.html#twig-loader-string" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><code>Twig_Loader_String</code></tt> loads templates from strings. It's a dummy loader as
the template reference is the template source code:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_String</span><span class="p">();</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;Hello {{ name }}!&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>This loader should only be used for unit testing as it has severe limitations:
several tags, like <tt class="docutils literal"><code>extends</code></tt> or <tt class="docutils literal"><code>include</code></tt> do not make sense to use as the
reference to the template is the template source code itself.</p>
</div>
<div class="section" id="twig-loader-array">
<h4><tt class="docutils literal"><code>Twig_Loader_Array</code></tt><a class="headerlink" href="api.html#twig-loader-array" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><code>Twig_Loader_Array</code></tt> loads a template from a PHP array. It's passed an array
of strings bound to template names:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;index.html&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello {{ name }}!&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>This loader is very useful for unit testing. It can also be used for small
projects where storing all templates in a single PHP file might make sense.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">When using the <tt class="docutils literal"><code>Array</code></tt> or <tt class="docutils literal"><code>String</code></tt> loaders with a cache mechanism, you
should know that a new cache key is generated each time a template content
&quot;changes&quot; (the cache key being the source code of the template). If you
don't want to see your cache grows out of control, you need to take care
of clearing the old cache file by yourself.</p>
</div></div>
</div>
<div class="section" id="twig-loader-chain">
<h4><tt class="docutils literal"><code>Twig_Loader_Chain</code></tt><a class="headerlink" href="api.html#twig-loader-chain" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><code>Twig_Loader_Chain</code></tt> delegates the loading of templates to other loaders:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;base.html&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;{% block content %}{% endblock %}&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$loader2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;index.html&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;{% extends &quot;base.twig&quot; %}{% block content %}Hello {{ name }}{% endblock %}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;base.html&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Will never be loaded&#39;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Chain</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$loader1</span><span class="p">,</span> <span class="nv">$loader2</span><span class="p">));</span>

<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>When looking for a template, Twig will try each loader in turn and it will
return as soon as the template is found. When rendering the <tt class="docutils literal"><code>index.html</code></tt>
template from the above example, Twig will load it with <tt class="docutils literal"><code>$loader2</code></tt> but the
<tt class="docutils literal"><code>base.html</code></tt> template will be loaded from <tt class="docutils literal"><code>$loader1</code></tt>.</p>
<p><tt class="docutils literal"><code>Twig_Loader_Chain</code></tt> accepts any loader that implements
<tt class="docutils literal"><code>Twig_LoaderInterface</code></tt>.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">You can also add loaders via the <tt class="docutils literal"><code>addLoader()</code></tt> method.</p>
</div></div>
</div>
</div>
<div class="section" id="create-your-own-loader">
<h3>Create your own Loader<a class="headerlink" href="api.html#create-your-own-loader" title="Permalink to this headline">¶</a></h3>
<p>All loaders implement the <tt class="docutils literal"><code>Twig_LoaderInterface</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">interface</span> <span class="nx">Twig_LoaderInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Gets the source code of a template, given its name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string $name string The name of the template to load</span>
<span class="sd">     *</span>
<span class="sd">     * @return string The template source code</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">getSource</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Gets the cache key to use for the cache for a given template name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string $name string The name of the template to load</span>
<span class="sd">     *</span>
<span class="sd">     * @return string The cache key</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">getCacheKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns true if the template is still fresh.</span>
<span class="sd">     *</span>
<span class="sd">     * @param string    $name The template name</span>
<span class="sd">     * @param timestamp $time The last modification time of the cached template</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">isFresh</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$time</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>As an example, here is how the built-in <tt class="docutils literal"><code>Twig_Loader_String</code></tt> reads:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Twig_Loader_String</span> <span class="k">implements</span> <span class="nx">Twig_LoaderInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSource</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCacheKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isFresh</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>isFresh()</code></tt> method must return <tt class="docutils literal"><code>true</code></tt> if the current cached template
is still fresh, given the last modification time, or <tt class="docutils literal"><code>false</code></tt> otherwise.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">As of Twig 1.11.0, you can also implement <tt class="docutils literal"><code>Twig_ExistsLoaderInterface</code></tt>
to make your loader faster when used with the chain loader.</p>
</div></div>
</div>
</div>
<div class="section" id="using-extensions">
<h2>Using Extensions<a class="headerlink" href="api.html#using-extensions" title="Permalink to this headline">¶</a></h2>
<p>Twig extensions are packages that add new features to Twig. Using an
extension is as simple as using the <tt class="docutils literal"><code>addExtension()</code></tt> method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span> <span class="nx">Twig_Extension_Sandbox</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>Twig comes bundled with the following extensions:</p>
<ul class="simple">
<li><em>Twig_Extension_Core</em>: Defines all the core features of Twig.</li>
<li><em>Twig_Extension_Escaper</em>: Adds automatic output-escaping and the possibility
to escape/unescape blocks of code.</li>
<li><em>Twig_Extension_Sandbox</em>: Adds a sandbox mode to the default Twig
environment, making it safe to evaluated untrusted code.</li>
<li><em>Twig_Extension_Optimizer</em>: Optimizers the node tree before compilation.</li>
</ul>
<p>The core, escaper, and optimizer extensions do not need to be added to the
Twig environment, as they are registered by default. You can disable an
already registered extension:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">removeExtension</span><span class="p">(</span><span class="s1">&#39;escaper&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="built-in-extensions">
<h2>Built-in Extensions<a class="headerlink" href="api.html#built-in-extensions" title="Permalink to this headline">¶</a></h2>
<p>This section describes the features added by the built-in extensions.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Read the chapter about extending Twig to learn how to create your own
extensions.</p>
</div></div>
<div class="section" id="core-extension">
<h3>Core Extension<a class="headerlink" href="api.html#core-extension" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><code>core</code></tt> extension defines all the core features of Twig:</p>
<ul class="simple">
<li>Tags:<ul>
<li><tt class="docutils literal"><code>for</code></tt></li>
<li><tt class="docutils literal"><code>if</code></tt></li>
<li><tt class="docutils literal"><code>extends</code></tt></li>
<li><tt class="docutils literal"><code>include</code></tt></li>
<li><tt class="docutils literal"><code>block</code></tt></li>
<li><tt class="docutils literal"><code>filter</code></tt></li>
<li><tt class="docutils literal"><code>macro</code></tt></li>
<li><tt class="docutils literal"><code>import</code></tt></li>
<li><tt class="docutils literal"><code>from</code></tt></li>
<li><tt class="docutils literal"><code>set</code></tt></li>
<li><tt class="docutils literal"><code>spaceless</code></tt></li>
<li><tt class="docutils literal"><code>autoescape</code></tt></li>
<li><tt class="docutils literal"><code>do</code></tt></li>
<li><tt class="docutils literal"><code>embed</code></tt></li>
<li><tt class="docutils literal"><code>flush</code></tt></li>
<li><tt class="docutils literal"><code>raw</code></tt></li>
<li><tt class="docutils literal"><code>sandbox</code></tt></li>
<li><tt class="docutils literal"><code>use</code></tt></li>
</ul>
</li>
<li>Filters:<ul>
<li><tt class="docutils literal"><code>date</code></tt></li>
<li><tt class="docutils literal"><code>format</code></tt></li>
<li><tt class="docutils literal"><code>replace</code></tt></li>
<li><tt class="docutils literal"><code>url_encode</code></tt></li>
<li><tt class="docutils literal"><code>json_encode</code></tt></li>
<li><tt class="docutils literal"><code>title</code></tt></li>
<li><tt class="docutils literal"><code>capitalize</code></tt></li>
<li><tt class="docutils literal"><code>upper</code></tt></li>
<li><tt class="docutils literal"><code>lower</code></tt></li>
<li><tt class="docutils literal"><code>striptags</code></tt></li>
<li><tt class="docutils literal"><code>join</code></tt></li>
<li><tt class="docutils literal"><code>reverse</code></tt></li>
<li><tt class="docutils literal"><code>length</code></tt></li>
<li><tt class="docutils literal"><code>sort</code></tt></li>
<li><tt class="docutils literal"><code>merge</code></tt></li>
<li><tt class="docutils literal"><code>default</code></tt></li>
<li><tt class="docutils literal"><code>keys</code></tt></li>
<li><tt class="docutils literal"><code>escape</code></tt></li>
<li><tt class="docutils literal"><code>e</code></tt></li>
<li><tt class="docutils literal"><code>abs</code></tt></li>
<li><tt class="docutils literal"><code>convert_encoding</code></tt></li>
<li><tt class="docutils literal"><code>date_modify</code></tt></li>
<li><tt class="docutils literal"><code>nl2br</code></tt></li>
<li><tt class="docutils literal"><code>number_format</code></tt></li>
<li><tt class="docutils literal"><code>raw</code></tt></li>
<li><tt class="docutils literal"><code>slice</code></tt></li>
<li><tt class="docutils literal"><code>trim</code></tt></li>
</ul>
</li>
<li>Functions:<ul>
<li><tt class="docutils literal"><code>range</code></tt></li>
<li><tt class="docutils literal"><code>constant</code></tt></li>
<li><tt class="docutils literal"><code>cycle</code></tt></li>
<li><tt class="docutils literal"><code>parent</code></tt></li>
<li><tt class="docutils literal"><code>block</code></tt></li>
<li><tt class="docutils literal"><code>attribute</code></tt></li>
<li><tt class="docutils literal"><code>date</code></tt></li>
<li><tt class="docutils literal"><code>dump</code></tt></li>
<li><tt class="docutils literal"><code>random</code></tt></li>
</ul>
</li>
<li>Tests:<ul>
<li><tt class="docutils literal"><code>even</code></tt></li>
<li><tt class="docutils literal"><code>odd</code></tt></li>
<li><tt class="docutils literal"><code>defined</code></tt></li>
<li><tt class="docutils literal"><code>sameas</code></tt></li>
<li><tt class="docutils literal"><code>null</code></tt></li>
<li><tt class="docutils literal"><code>divisibleby</code></tt></li>
<li><tt class="docutils literal"><code>constant</code></tt></li>
<li><tt class="docutils literal"><code>empty</code></tt></li>
<li><tt class="docutils literal"><code>iterable</code></tt></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="escaper-extension">
<h3>Escaper Extension<a class="headerlink" href="api.html#escaper-extension" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><code>escaper</code></tt> extension adds automatic output escaping to Twig. It defines a
tag, <tt class="docutils literal"><code>autoescape</code></tt>, and a filter, <tt class="docutils literal"><code>raw</code></tt>.</p>
<p>When creating the escaper extension, you can switch on or off the global
output escaping strategy:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$escaper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Extension_Escaper</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$escaper</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>If set to <tt class="docutils literal"><code>true</code></tt>, all variables in templates are escaped (using the <tt class="docutils literal"><code>html</code></tt>
escaping strategy), except those using the <tt class="docutils literal"><code>raw</code></tt> filter:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{{</span> <span class="nv">article.to_html</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>You can also change the escaping mode locally by using the <tt class="docutils literal"><code>autoescape</code></tt> tag
(see the <a class="reference internal" href="tags/autoescape.html"><em>autoescape</em></a> doc for the syntax used before
Twig 1.8):</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">&#39;html&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="x">      </span><span class="c">{# var won&#39;t be escaped #}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span> <span class="cp">}}</span><span class="x">   </span><span class="c">{# var won&#39;t be double-escaped #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="warning"></div><div class="admonition admonition-warning"><p class="first admonition-title">Warning</p>
<p class="last">The <tt class="docutils literal"><code>autoescape</code></tt> tag has no effect on included files.</p>
</div></div>
<p>The escaping rules are implemented as follows:</p>
<ul>
<li><p class="first">Literals (integers, booleans, arrays, ...) used in the template directly as
variables or filter arguments are never automatically escaped:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{{</span> <span class="s2">&quot;Twig&lt;br /&gt;&quot;</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# won&#39;t be escaped #}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">set</span> <span class="nv">text</span> <span class="o">=</span> <span class="s2">&quot;Twig&lt;br /&gt;&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">text</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# will be escaped #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><p class="first">Expressions which the result is always a literal or a variable marked safe
are never automatically escaped:</p>
<div class="literal-block"><div class="highlight-jinja"><pre>{{ foo ? "Twig&lt;br /&gt;" : "&lt;br /&gt;Twig" }} {# won't be escaped #}

{% set text = "Twig&lt;br /&gt;" %}
{{ foo ? text : "&lt;br /&gt;Twig" }} {# will be escaped #}

{% set text = "Twig&lt;br /&gt;" %}
{{ foo ? text|raw : "&lt;br /&gt;Twig" }} {# won't be escaped #}

{% set text = "Twig&lt;br /&gt;" %}
{{ foo ? text|escape : "&lt;br /&gt;Twig" }} {# the result of the expression won't be escaped #}</pre>
</div></div>
</li>
<li><p class="first">Escaping is applied before printing, after any other filter is applied:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">upper</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# is equivalent to {{ var|upper|escape }} #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><p class="first">The <cite>raw</cite> filter should only be used at the end of the filter chain:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">raw</span><span class="o">|</span><span class="nf">upper</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# will be escaped #}</span><span class="x"></span>

<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">upper</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# won&#39;t be escaped #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><p class="first">Automatic escaping is not applied if the last filter in the chain is marked
safe for the current context (e.g. <tt class="docutils literal"><code>html</code></tt> or <tt class="docutils literal"><code>js</code></tt>). <tt class="docutils literal"><code>escaper</code></tt> and
<tt class="docutils literal"><code>escaper('html')</code></tt> are marked safe for html, <tt class="docutils literal"><code>escaper('js')</code></tt> is marked
safe for javascript, <tt class="docutils literal"><code>raw</code></tt> is marked safe for everything.</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">&#39;js&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">&#39;html&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# will be escaped for html and javascript #}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# will be escaped for javascript #}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">&#39;js&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> </span><span class="c">{# won&#39;t be double-escaped #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Note that autoescaping has some limitations as escaping is applied on
expressions after evaluation. For instance, when working with
concatenation, <tt class="docutils literal"><code>{{ foo|raw ~ bar }}</code></tt> won't give the expected result as
escaping is applied on the result of the concatenation, not on the
individual variables (so, the <tt class="docutils literal"><code>raw</code></tt> filter won't have any effect here).</p>
</div></div>
</div>
<div class="section" id="sandbox-extension">
<h3>Sandbox Extension<a class="headerlink" href="api.html#sandbox-extension" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><code>sandbox</code></tt> extension can be used to evaluate untrusted code. Access to
unsafe attributes and methods is prohibited. The sandbox security is managed
by a policy instance. By default, Twig comes with one policy class:
<tt class="docutils literal"><code>Twig_Sandbox_SecurityPolicy</code></tt>. This class allows you to white-list some
tags, filters, properties, and methods:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$tags</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;if&#39;</span><span class="p">);</span>
<span class="nv">$filters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;upper&#39;</span><span class="p">);</span>
<span class="nv">$methods</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;Article&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;getTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;getBody&#39;</span><span class="p">),</span>
<span class="p">);</span>
<span class="nv">$properties</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;Article&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">),</span>
<span class="p">);</span>
<span class="nv">$functions</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">);</span>
<span class="nv">$policy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Sandbox_SecurityPolicy</span><span class="p">(</span><span class="nv">$tags</span><span class="p">,</span> <span class="nv">$filters</span><span class="p">,</span> <span class="nv">$methods</span><span class="p">,</span> <span class="nv">$properties</span><span class="p">,</span> <span class="nv">$functions</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>With the previous configuration, the security policy will only allow usage of
the <tt class="docutils literal"><code>if</code></tt> tag, and the <tt class="docutils literal"><code>upper</code></tt> filter. Moreover, the templates will only be
able to call the <tt class="docutils literal"><code>getTitle()</code></tt> and <tt class="docutils literal"><code>getBody()</code></tt> methods on <tt class="docutils literal"><code>Article</code></tt>
objects, and the <tt class="docutils literal"><code>title</code></tt> and <tt class="docutils literal"><code>body</code></tt> public properties. Everything else
won't be allowed and will generate a <tt class="docutils literal"><code>Twig_Sandbox_SecurityError</code></tt> exception.</p>
<p>The policy object is the first argument of the sandbox constructor:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$sandbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Extension_Sandbox</span><span class="p">(</span><span class="nv">$policy</span><span class="p">);</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>By default, the sandbox mode is disabled and should be enabled when including
untrusted template code by using the <tt class="docutils literal"><code>sandbox</code></tt> tag:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">sandbox</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;user.html&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endsandbox</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>You can sandbox all templates by passing <tt class="docutils literal"><code>true</code></tt> as the second argument of
the extension constructor:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$sandbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Extension_Sandbox</span><span class="p">(</span><span class="nv">$policy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="optimizer-extension">
<h3>Optimizer Extension<a class="headerlink" href="api.html#optimizer-extension" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><code>optimizer</code></tt> extension optimizes the node tree before compilation:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span> <span class="nx">Twig_Extension_Optimizer</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>By default, all optimizations are turned on. You can select the ones you want
to enable by passing them to the constructor:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$optimizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Extension_Optimizer</span><span class="p">(</span><span class="nx">Twig_NodeVisitor_Optimizer</span><span class="o">::</span><span class="na">OPTIMIZE_FOR</span><span class="p">);</span>

<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$optimizer</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="api.html#exceptions" title="Permalink to this headline">¶</a></h2>
<p>Twig can throw exceptions:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>Twig_Error</code></tt>: The base exception for all errors.</li>
<li><tt class="docutils literal"><code>Twig_Error_Syntax</code></tt>: Thrown to tell the user that there is a problem with
the template syntax.</li>
<li><tt class="docutils literal"><code>Twig_Error_Runtime</code></tt>: Thrown when an error occurs at runtime (when a filter
does not exist for instance).</li>
<li><tt class="docutils literal"><code>Twig_Error_Loader</code></tt>: Thrown when an error occurs during template loading.</li>
<li><tt class="docutils literal"><code>Twig_Sandbox_SecurityError</code></tt>: Thrown when an unallowed tag, filter, or
method is called in a sandboxed template.</li>
</ul>
</div>
</div>

    </div>

            <div class="navigation">
                            <a accesskey="P" title="Twig for Template Designers" href="templates.html">
                    &laquo;&nbsp;Twig for Template Designers
                </a>
                        <span class="separator">|</span>                            <a accesskey="N" title="Extending Twig" href="advanced.html">
                    Extending Twig&nbsp;&raquo;
                </a>
                    </div>
          </div>
      <div class="ft">
        <div class="content">
          This website is powered by PHP and Twig. The Twig <a href="../images/twig-logo.png">logo</a> is &copy; 2010-2012 Sensio Labs
        </div>
      </div>
    </div>
  </body>
</html>
