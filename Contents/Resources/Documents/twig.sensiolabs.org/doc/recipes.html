<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index, follow, all" />
    <meta name="Author" content="Sensio Labs" />
    <meta name="Language" content="en" />
    <meta name="Copyright" content="Sensio" />
    <meta name="Publisher" content="Sensio" />
    <meta name="Description" content="Twig - The flexible, fast, and secure template engine for PHP" />
    <meta name="Keywords" content="twig, templating, template, engine, template engine, template language, php" />

    <title>Recipes - Documentation - Twig - The flexible, fast, and secure PHP template engine</title>

    <link href="../css/reset-min.css" rel="stylesheet" type="text/css" />
    <link href="../css/base.css" rel="stylesheet" type="text/css" />
    <link href="../css/colors.css" rel="stylesheet" type="text/css" />
    <link href="../css/code.css" rel="stylesheet" type="text/css" />
    <link href="../css/pygments.css" rel="stylesheet" type="text/css" />

    
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/twig-project" />

    <link href="http://connect.sensiolabs.com/css/sln.css" rel="stylesheet" type="text/css" media="all" />

    <script type="text/javascript" src="../js/jquery-1.7.2.min.js"></script>

    <script type="text/javascript">
        (function(w, d, s) {
            function go() {
                var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
                    if (d.getElementById(id)) {return;}
                    js = d.createElement(s); js.src = url; js.id = id;
                    fjs.parentNode.insertBefore(js, fjs);
                };
                load('https://connect.sensiolabs.com/sln.js?customize_url=/js/sln_customize.js', 'sln_bar');
            }
            if (w.addEventListener) { w.addEventListener("load", go, false); }
            else if (w.attachEvent) { w.attachEvent("onload",go); }
        } (window, document, 'script'));
    </script>

    <!--[if IE 6]>
      <script type="text/javascript" src="/js/DD_belatedPNG_0.0.7a-min.js"></script>
      <script type="text/javascript">
        DD_belatedPNG.fix('.png_fix');
      </script>
    <![endif]-->

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10931939-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
  </head>
  <body>
    <div id="sln"></div>
    <div class="hd">
      <div class="illustration png_fix">
        <div class="content">
          <div class="sensio_product">
            <img class="png_fix" src="../images/sensio-labs-product.png" alt="a Sensio Labs Product" />
          </div>
          <div class="clearfix">
            <div class="logo_header"><a href="../index.html">TWIG</a></div>
            <h1 class="title_header">
              The flexible, fast, and secure<br />template engine for PHP
            </h1>
          </div>

          <div class="menu">
            <ul>
              <li><a href="../index.html">ABOUT</a></li>
              <li><a class="active" href="../documentation">DOCUMENTATION</a></li>
              <li><a href="http://blog.twig.sensiolabs.org/">BLOG</a></li>
              <li><a href="../development">DEVELOPMENT</a></li>
              <li><a href="../contributors">CONTRIBUTORS</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="bd">
      <div class="content">
                        <div class="infobar clearfix">
                    <div id="doc-toc" class="infobar-box">
            <h3>Table of Contents</h3>
            <ul>
<li><a class="reference internal" href="recipes.html#">Recipes</a><ul>
<li><a class="reference internal" href="recipes.html#making-a-layout-conditional">Making a Layout conditional</a></li>
<li><a class="reference internal" href="recipes.html#making-an-include-dynamic">Making an Include dynamic</a></li>
<li><a class="reference internal" href="recipes.html#overriding-a-template-that-also-extends-itself">Overriding a Template that also extends itself</a></li>
<li><a class="reference internal" href="recipes.html#customizing-the-syntax">Customizing the Syntax</a></li>
<li><a class="reference internal" href="recipes.html#using-dynamic-object-properties">Using dynamic Object Properties</a></li>
<li><a class="reference internal" href="recipes.html#accessing-the-parent-context-in-nested-loops">Accessing the parent Context in Nested Loops</a></li>
<li><a class="reference internal" href="recipes.html#defining-undefined-functions-and-filters-on-the-fly">Defining undefined Functions and Filters on the Fly</a></li>
<li><a class="reference internal" href="recipes.html#validating-the-template-syntax">Validating the Template Syntax</a></li>
<li><a class="reference internal" href="recipes.html#refreshing-modified-templates-when-apc-is-enabled-and-apc-stat-0">Refreshing modified Templates when APC is enabled and apc.stat = 0</a></li>
<li><a class="reference internal" href="recipes.html#reusing-a-stateful-node-visitor">Reusing a stateful Node Visitor</a></li>
<li><a class="reference internal" href="recipes.html#using-the-template-name-to-set-the-default-escaping-strategy">Using the Template name to set the default Escaping Strategy</a></li>
<li><a class="reference internal" href="recipes.html#using-a-database-to-store-templates">Using a Database to store Templates</a></li>
<li><a class="reference internal" href="recipes.html#using-different-template-sources">Using different Template Sources</a></li>
</ul>
</li>
</ul>

            </div>
        
        <div class="infobar-box">
            <h3>Questions &amp; Feedback</h3>
            <div class="feedback">
                <p>
                  <strong>Found a typo or an error?</strong><br />
                  Want to improve this document? <a href="https://github.com/fabpot/Twig/edit/master/doc/recipes.rst">Edit</a> it.
                </p>
                <p>
                  <strong>Need support or have a technical question?</strong><br />
                  Post to the <a href="http://groups.google.com/group/twig-users">user mailing-list</a>.
                 </p>
            </div>

            <h3>License</h3>
            <div id="license">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" src="http://symfony.com/images/license.png" /></a>
                Twig <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/MovingImage" rel="dc:type">documentation</span> is licensed under a
                Creative Commons Attribution-Share Alike 3.0
                Unported <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">License</a>.
            </div>
        </div>
    </div>

    <div class="body-web">
        <div class="section" id="recipes">
<h1>Recipes<a class="headerlink" href="recipes.html#recipes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="making-a-layout-conditional">
<h2>Making a Layout conditional<a class="headerlink" href="recipes.html#making-a-layout-conditional" title="Permalink to this headline">¶</a></h2>
<p>Working with Ajax means that the same content is sometimes displayed as is,
and sometimes decorated with a layout. As Twig layout template names can be
any valid expression, you can pass a variable that evaluates to <tt class="docutils literal"><code>true</code></tt> when
the request is made via Ajax and choose the layout accordingly:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">request.ajax</span> <span class="p">?</span> <span class="s2">&quot;base_ajax.html&quot;</span> <span class="o">:</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    This is the content to be displayed.</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="making-an-include-dynamic">
<h2>Making an Include dynamic<a class="headerlink" href="recipes.html#making-an-include-dynamic" title="Permalink to this headline">¶</a></h2>
<p>When including a template, its name does not need to be a string. For
instance, the name can depend on the value of a variable:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">include</span> <span class="nv">var</span> <span class="o">~</span> <span class="s1">&#39;_foo.html&#39;</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>If <tt class="docutils literal"><code>var</code></tt> evaluates to <tt class="docutils literal"><code>index</code></tt>, the <tt class="docutils literal"><code>index_foo.html</code></tt> template will be
rendered.</p>
<p>As a matter of fact, the template name can be any valid expression, such as
the following:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">include</span> <span class="nv">var</span><span class="o">|</span><span class="nf">default</span><span class="o">(</span><span class="s1">&#39;index&#39;</span><span class="o">)</span> <span class="o">~</span> <span class="s1">&#39;_foo.html&#39;</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="overriding-a-template-that-also-extends-itself">
<h2>Overriding a Template that also extends itself<a class="headerlink" href="recipes.html#overriding-a-template-that-also-extends-itself" title="Permalink to this headline">¶</a></h2>
<p>A template can be customized in two different ways:</p>
<ul class="simple">
<li><em>Inheritance</em>: A template <em>extends</em> a parent template and overrides some
blocks;</li>
<li><em>Replacement</em>: If you use the filesystem loader, Twig loads the first
template it finds in a list of configured directories; a template found in a
directory <em>replaces</em> another one from a directory further in the list.</li>
</ul>
<p>But how do you combine both: <em>replace</em> a template that also extends itself
(aka a template in a directory further in the list)?</p>
<p>Let's say that your templates are loaded from both <tt class="docutils literal"><code>.../templates/mysite</code></tt>
and <tt class="docutils literal"><code>.../templates/default</code></tt> in this order. The <tt class="docutils literal"><code>page.twig</code></tt> template,
stored in <tt class="docutils literal"><code>.../templates/default</code></tt> reads as follows:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">{# page.twig #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.twig&quot;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>You can replace this template by putting a file with the same name in
<tt class="docutils literal"><code>.../templates/mysite</code></tt>. And if you want to extend the original template, you
might be tempted to write the following:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">{# page.twig in .../templates/mysite #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;page.twig&quot;</span> <span class="cp">%}</span><span class="x"> </span><span class="c">{# from .../templates/default #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>Of course, this will not work as Twig will always load the template from
<tt class="docutils literal"><code>.../templates/mysite</code></tt>.</p>
<p>It turns out it is possible to get this to work, by adding a directory right
at the end of your template directories, which is the parent of all of the
other directories: <tt class="docutils literal"><code>.../templates</code></tt> in our case. This has the effect of
making every template file within our system uniquely addressable. Most of the
time you will use the &quot;normal&quot; paths, but in the special case of wanting to
extend a template with an overriding version of itself we can reference its
parent's full, unambiguous template path in the extends tag:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">{# page.twig in .../templates/mysite #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;default/page.twig&quot;</span> <span class="cp">%}</span><span class="x"> </span><span class="c">{# from .../templates #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">This recipe was inspired by the following Django wiki page:
<a class="reference external" href="http://code.djangoproject.com/wiki/ExtendingTemplates">http://code.djangoproject.com/wiki/ExtendingTemplates</a></p>
</div></div>
</div>
<div class="section" id="customizing-the-syntax">
<h2>Customizing the Syntax<a class="headerlink" href="recipes.html#customizing-the-syntax" title="Permalink to this headline">¶</a></h2>
<p>Twig allows some syntax customization for the block delimiters. It's not
recommended to use this feature as templates will be tied with your custom
syntax. But for specific projects, it can make sense to change the defaults.</p>
<p>To change the block delimiters, you need to create your own lexer object:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">();</span>

<span class="nv">$lexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Lexer</span><span class="p">(</span><span class="nv">$twig</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;tag_comment&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{#&#39;</span><span class="p">,</span> <span class="s1">&#39;#}&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_block&#39;</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{%&#39;</span><span class="p">,</span> <span class="s1">&#39;%}&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_variable&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}&#39;</span><span class="p">),</span>
<span class="p">));</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">setLexer</span><span class="p">(</span><span class="nv">$lexer</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Here are some configuration example that simulates some other template engines
syntax:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Ruby erb syntax</span>
<span class="nv">$lexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Lexer</span><span class="p">(</span><span class="nv">$twig</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;tag_comment&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&lt;%#&#39;</span><span class="p">,</span> <span class="s1">&#39;%&gt;&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_block&#39;</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&lt;%&#39;</span><span class="p">,</span> <span class="s1">&#39;%&gt;&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_variable&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&lt;%=&#39;</span><span class="p">,</span> <span class="s1">&#39;%&gt;&#39;</span><span class="p">),</span>
<span class="p">));</span>

<span class="c1">// SGML Comment Syntax</span>
<span class="nv">$lexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Lexer</span><span class="p">(</span><span class="nv">$twig</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;tag_comment&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&lt;!--#&#39;</span><span class="p">,</span> <span class="s1">&#39;--&gt;&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_block&#39;</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&lt;!--&#39;</span><span class="p">,</span> <span class="s1">&#39;--&gt;&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_variable&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;${&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span>
<span class="p">));</span>

<span class="c1">// Smarty like</span>
<span class="nv">$lexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Lexer</span><span class="p">(</span><span class="nv">$twig</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;tag_comment&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{*&#39;</span><span class="p">,</span> <span class="s1">&#39;*}&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_block&#39;</span>    <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tag_variable&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;{$&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="using-dynamic-object-properties">
<h2>Using dynamic Object Properties<a class="headerlink" href="recipes.html#using-dynamic-object-properties" title="Permalink to this headline">¶</a></h2>
<p>When Twig encounters a variable like <tt class="docutils literal"><code>article.title</code></tt>, it tries to find a
<tt class="docutils literal"><code>title</code></tt> public property in the <tt class="docutils literal"><code>article</code></tt> object.</p>
<p>It also works if the property does not exist but is rather defined dynamically
thanks to the magic <tt class="docutils literal"><code>__get()</code></tt> method; you just need to also implement the
<tt class="docutils literal"><code>__isset()</code></tt> magic method like shown in the following snippet of code:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Article</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span> <span class="o">==</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;The title&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// throw some kind of error</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__isset</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span> <span class="o">==</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="accessing-the-parent-context-in-nested-loops">
<h2>Accessing the parent Context in Nested Loops<a class="headerlink" href="recipes.html#accessing-the-parent-context-in-nested-loops" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, when using nested loops, you need to access the parent context. The
parent context is always accessible via the <tt class="docutils literal"><code>loop.parent</code></tt> variable. For
instance, if you have the following template data:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;topics&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;topic1&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Message 1 of topic 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Message 2 of topic 1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;topic2&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Message 1 of topic 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Message 2 of topic 2&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>And the following template to display all messages in all topics:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">for</span> <span class="nv">topic</span><span class="o">,</span> <span class="nv">messages</span> <span class="k">in</span> <span class="nv">topics</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    * </span><span class="cp">{{</span> <span class="nb">loop</span><span class="nv">.index</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">topic</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">      - </span><span class="cp">{{</span> <span class="nb">loop</span><span class="nv">.parent.loop.index</span> <span class="cp">}}</span><span class="x">.</span><span class="cp">{{</span> <span class="nb">loop</span><span class="nv">.index</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>The output will be similar to:</p>
<div class="literal-block"><div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre>* 1: topic1
  - 1.1: The message 1 of topic 1
  - 1.2: The message 2 of topic 1
* 2: topic2
  - 2.1: The message 1 of topic 2
  - 2.2: The message 2 of topic 2
</pre></div>
</td></tr></table></div></div>
<p>In the inner loop, the <tt class="docutils literal"><code>loop.parent</code></tt> variable is used to access the outer
context. So, the index of the current <tt class="docutils literal"><code>topic</code></tt> defined in the outer for loop
is accessible via the <tt class="docutils literal"><code>loop.parent.loop.index</code></tt> variable.</p>
</div>
<div class="section" id="defining-undefined-functions-and-filters-on-the-fly">
<h2>Defining undefined Functions and Filters on the Fly<a class="headerlink" href="recipes.html#defining-undefined-functions-and-filters-on-the-fly" title="Permalink to this headline">¶</a></h2>
<p>When a function (or a filter) is not defined, Twig defaults to throw a
<tt class="docutils literal"><code>Twig_Error_Syntax</code></tt> exception. However, it can also call a <a class="reference external" href="http://www.php.net/manual/en/function.is-callable.php">callback</a> (any
valid PHP callable) which should return a function (or a filter).</p>
<p>For filters, register callbacks with <tt class="docutils literal"><code>registerUndefinedFilterCallback()</code></tt>.
For functions, use <tt class="docutils literal"><code>registerUndefinedFunctionCallback()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// auto-register all native PHP functions as Twig functions</span>
<span class="c1">// don&#39;t try this at home as it&#39;s not secure at all!</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">registerUndefinedFunctionCallback</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Twig_Function_Function</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
<p>If the callable is not able to return a valid function (or filter), it must
return <tt class="docutils literal"><code>false</code></tt>.</p>
<p>If you register more than one callback, Twig will call them in turn until one
does not return <tt class="docutils literal"><code>false</code></tt>.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">As the resolution of functions and filters is done during compilation,
there is no overhead when registering these callbacks.</p>
</div></div>
</div>
<div class="section" id="validating-the-template-syntax">
<h2>Validating the Template Syntax<a class="headerlink" href="recipes.html#validating-the-template-syntax" title="Permalink to this headline">¶</a></h2>
<p>When template code is providing by a third-party (through a web interface for
instance), it might be interesting to validate the template syntax before
saving it. If the template code is stored in a <cite>$template</cite> variable, here is
how you can do it:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">tokenize</span><span class="p">(</span><span class="nv">$template</span><span class="p">));</span>

    <span class="c1">// the $template is valid</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Twig_Error_Syntax</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $template contains one or more syntax errors</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>If you iterate over a set of files, you can pass the filename to the
<tt class="docutils literal"><code>tokenize()</code></tt> method to get the filename in the exception message:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">tokenize</span><span class="p">(</span><span class="nv">$template</span><span class="p">,</span> <span class="nv">$file</span><span class="p">));</span>

        <span class="c1">// the $template is valid</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Twig_Error_Syntax</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $template contains one or more syntax errors</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">This method won't catch any sandbox policy violations because the policy
is enforced during template rendering (as Twig needs the context for some
checks like allowed methods on objects).</p>
</div></div>
</div>
<div class="section" id="refreshing-modified-templates-when-apc-is-enabled-and-apc-stat-0">
<h2>Refreshing modified Templates when APC is enabled and apc.stat = 0<a class="headerlink" href="recipes.html#refreshing-modified-templates-when-apc-is-enabled-and-apc-stat-0" title="Permalink to this headline">¶</a></h2>
<p>When using APC with <tt class="docutils literal"><code>apc.stat</code></tt> set to <tt class="docutils literal"><code>0</code></tt> and Twig cache enabled, clearing
the template cache won't update the APC cache. To get around this, one can
extend <tt class="docutils literal"><code>Twig_Environment</code></tt> and force the update of the APC cache when Twig
rewrites the cache:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Twig_Environment_APC</span> <span class="k">extends</span> <span class="nx">Twig_Environment</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">writeCacheFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$content</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">writeCacheFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

        <span class="c1">// Compile cached file into bytecode cache</span>
        <span class="nb">apc_compile_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="reusing-a-stateful-node-visitor">
<h2>Reusing a stateful Node Visitor<a class="headerlink" href="recipes.html#reusing-a-stateful-node-visitor" title="Permalink to this headline">¶</a></h2>
<p>When attaching a visitor to a <tt class="docutils literal"><code>Twig_Environment</code></tt> instance, Twig uses it to
visit <em>all</em> templates it compiles. If you need to keep some state information
around, you probably want to reset it when visiting a new template.</p>
<p>This can be easily achieved with the following code:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">protected</span> <span class="nv">$someTemplateState</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">enterNode</span><span class="p">(</span><span class="nx">Twig_NodeInterface</span> <span class="nv">$node</span><span class="p">,</span> <span class="nx">Twig_Environment</span> <span class="nv">$env</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="nx">instanceof</span> <span class="nx">Twig_Node_Module</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// reset the state as we are entering a new template</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">someTemplateState</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>

    <span class="k">return</span> <span class="nv">$node</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="using-the-template-name-to-set-the-default-escaping-strategy">
<h2>Using the Template name to set the default Escaping Strategy<a class="headerlink" href="recipes.html#using-the-template-name-to-set-the-default-escaping-strategy" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 1.8: </span>This recipe requires Twig 1.8 or later.</p>
<p>The <tt class="docutils literal"><code>autoescape</code></tt> option determines the default escaping strategy to use when
no escaping is applied on a variable. When Twig is used to mostly generate
HTML files, you can set it to <tt class="docutils literal"><code>html</code></tt> and explicitly change it to <tt class="docutils literal"><code>js</code></tt> when
you have some dynamic JavaScript files thanks to the <tt class="docutils literal"><code>autoescape</code></tt> tag:</p>
<div class="literal-block"><div class="highlight-jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">&#39;js&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    ... some JS ...</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></table></div></div>
<p>But if you have many HTML and JS files, and if your template names follow some
conventions, you can instead determine the default escaping strategy to use
based on the template name. Let's say that your template names always ends
with <tt class="docutils literal"><code>.html</code></tt> for HTML files, <tt class="docutils literal"><code>.js</code></tt> for JavaScript ones, and <tt class="docutils literal"><code>.css</code></tt> for
stylesheets, here is how you can configure Twig:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TwigEscapingGuesser</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">guess</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// get the format</span>
        <span class="nv">$format</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nb">strrpos</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;js&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="s1">&#39;js&#39;</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;css&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="s1">&#39;css&#39;</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;html&#39;</span><span class="o">:</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span> <span class="s1">&#39;html&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="s1">&#39;/path/to/templates&#39;</span><span class="p">);</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;autoescape&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">TwigEscapingGuesser</span><span class="p">(),</span> <span class="s1">&#39;guess&#39;</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>This dynamic strategy does not incur any overhead at runtime as auto-escaping
is done at compilation time.</p>
</div>
<div class="section" id="using-a-database-to-store-templates">
<h2>Using a Database to store Templates<a class="headerlink" href="recipes.html#using-a-database-to-store-templates" title="Permalink to this headline">¶</a></h2>
<p>If you are developing a CMS, templates are usually stored in a database. This
recipe gives you a simple PDO template loader you can use as a starting point
for your own.</p>
<p>First, let's create a temporary in-memory SQLite3 database to work with:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;sqlite::memory:&#39;</span><span class="p">);</span>
<span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;CREATE TABLE templates (name STRING, source STRING, last_modified INTEGER)&#39;</span><span class="p">);</span>
<span class="nv">$base</span> <span class="o">=</span> <span class="s1">&#39;{% block content %}{% endblock %}&#39;</span><span class="p">;</span>
<span class="nv">$index</span> <span class="o">=</span> <span class="s1">&#39;</span>
<span class="s1">{% extends &quot;base.twig&quot; %}</span>
<span class="s1">{% block content %}Hello {{ name }}{% endblock %}</span>
<span class="s1">&#39;</span><span class="p">;</span>
<span class="nv">$now</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
<span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;INSERT INTO templates (name, source, last_modified) VALUES (&#39;base.twig&#39;, &#39;</span><span class="si">$base</span><span class="s2">&#39;, </span><span class="si">$now</span><span class="s2">)&quot;</span><span class="p">);</span>
<span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;INSERT INTO templates (name, source, last_modified) VALUES (&#39;index.twig&#39;, &#39;</span><span class="si">$index</span><span class="s2">&#39;, </span><span class="si">$now</span><span class="s2">)&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>We have created a simple <tt class="docutils literal"><code>templates</code></tt> table that hosts two templates:
<tt class="docutils literal"><code>base.twig</code></tt> and <tt class="docutils literal"><code>index.twig</code></tt>.</p>
<p>Now, let's define a loader able to use this database:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DatabaseTwigLoader</span> <span class="k">implements</span> <span class="nx">Twig_LoaderInterface</span><span class="p">,</span> <span class="nx">Twig_ExistsLoaderInterface</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$dbh</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">PDO</span> <span class="nv">$dbh</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dbh</span> <span class="o">=</span> <span class="nv">$dbh</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSource</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$source</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Twig_Error_Loader</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Template &quot;%s&quot; does not exist.&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$source</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Twig_ExistsLoaderInterface as of Twig 1.11</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exists</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$name</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCacheKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isFresh</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$lastModified</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">(</span><span class="s1">&#39;last_modified&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$lastModified</span> <span class="o">&lt;=</span> <span class="nv">$time</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getValue</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$sth</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dbh</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT &#39;</span><span class="o">.</span><span class="nv">$column</span><span class="o">.</span><span class="s1">&#39; FROM templates WHERE name = :name&#39;</span><span class="p">);</span>
        <span class="nv">$sth</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;:name&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$name</span><span class="p">));</span>

        <span class="k">return</span> <span class="nv">$sth</span><span class="o">-&gt;</span><span class="na">fetchColumn</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Finally, here is an example on how you can use it:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseTwigLoader</span><span class="p">(</span><span class="nv">$dbh</span><span class="p">);</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;index.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="using-different-template-sources">
<h2>Using different Template Sources<a class="headerlink" href="recipes.html#using-different-template-sources" title="Permalink to this headline">¶</a></h2>
<p>This recipe is the continuation of the previous one. Even if you store the
contributed templates in a database, you might want to keep the original/base
templates on the filesystem. When templates can be loaded from different
sources, you need to use the <tt class="docutils literal"><code>Twig_Loader_Chain</code></tt> loader.</p>
<p>As you can see in the previous recipe, we reference the template in the exact
same way as we would have done it with a regular filesystem loader. This is
the key to be able to mix and match templates coming from the database, the
filesystem, or any other loader for that matter: the template name should be a
logical name, and not the path from the filesystem:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$loader1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseTwigLoader</span><span class="p">(</span><span class="nv">$dbh</span><span class="p">);</span>
<span class="nv">$loader2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;base.twig&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;{% block content %}{% endblock %}&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Chain</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$loader1</span><span class="p">,</span> <span class="nv">$loader2</span><span class="p">));</span>

<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;index.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Now that the <tt class="docutils literal"><code>base.twig</code></tt> templates is defined in an array loader, you can
remove it from the database, and everything else will still work as before.</p>
</div>
</div>

    </div>

            <div class="navigation">
                            <a accesskey="P" title="Twig Internals" href="internals.html">
                    &laquo;&nbsp;Twig Internals
                </a>
                        <span class="separator">|</span>                            <a accesskey="N" title="Coding Standards" href="coding_standards.html">
                    Coding Standards&nbsp;&raquo;
                </a>
                    </div>
          </div>
      <div class="ft">
        <div class="content">
          This website is powered by PHP and Twig. The Twig <a href="../images/twig-logo.png">logo</a> is &copy; 2010-2012 Sensio Labs
        </div>
      </div>
    </div>
  </body>
</html>
